"object"!==typeof JSON&&(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function c(a){f.lastIndex=0;return f.test(a)?'"'+a.replace(f,function(a){var b=j[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,b){var k,f,n,j,p=g,m,h=b[a];h&&("object"===typeof h&&"function"===typeof h.toJSON)&&(h=h.toJSON(a));"function"===typeof l&&(h=l.call(b,a,h));switch(typeof h){case "string":return c(h);case "number":return isFinite(h)?String(h):"null";case "boolean":case "null":return String(h);
case "object":if(!h)return"null";g+=e;m=[];if("[object Array]"===Object.prototype.toString.apply(h)){j=h.length;for(k=0;k<j;k+=1)m[k]=d(k,h)||"null";n=0===m.length?"[]":g?"[\n"+g+m.join(",\n"+g)+"\n"+p+"]":"["+m.join(",")+"]";g=p;return n}if(l&&"object"===typeof l){j=l.length;for(k=0;k<j;k+=1)"string"===typeof l[k]&&(f=l[k],(n=d(f,h))&&m.push(c(f)+(g?": ":":")+n))}else for(f in h)Object.prototype.hasOwnProperty.call(h,f)&&(n=d(f,h))&&m.push(c(f)+(g?": ":":")+n);n=0===m.length?"{}":g?"{\n"+g+m.join(",\n"+
g)+"\n"+p+"}":"{"+m.join(",")+"}";g=p;return n}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,e,j={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var f;e=g="";if("number"===typeof c)for(f=0;f<c;f+=1)e+=" ";else"string"===typeof c&&(e=c);if((l=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return d("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function d(a,b){var f,g,e=a[b];if(e&&"object"===typeof e)for(f in e)Object.prototype.hasOwnProperty.call(e,f)&&(g=d(e,f),void 0!==g?e[f]=g:delete e[f]);return c.call(a,b,e)}var f;a=String(a);b.lastIndex=0;b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof c?d({"":f},""):f;throw new SyntaxError("JSON.parse");})})();
var Organics=new function(){this.Debug=!1;this.WebSocketSupported="WebSocket"in window||"MozWebSocket"in window;this.Connect="A!B@C#D$E%F^G&H*I(J)";this.Disconnect="a1b2c3d4e5f6g7h8i9j0";this.__rtWebSocketEstablishConnection="wsec";this.__rtLongPollEstablishConnection="lpec";this.__rtLongPoll="lp";this.__rtMessage="m";this.ErrNotConnected="not currently connected to server";this.__addEventListener=function(a,c,d){document.addEventListener?a.addEventListener(c,d,!1):a.attachEvent("on"+c,d)};this.__isPageBeingRefreshed=
!1;this.__addEventListener(window,"beforeunload",function(){Organics.__isPageBeingRefreshed=!0});this.__Log=function(a){Organics.Debug&&window.console&&console.log("Organics: "+a)};this.__StackTrace=function(){return Error("StackTrace").stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")};this.__LogStackTrace=function(){if(Organics.Debug){for(var a=Organics.__StackTrace(),c=0;c<a.length;c++)window.console&&console.log(a[c]);
window.console&&console.log("\n")}};this.__StringStartsWith=function(a,c){return a.slice(0,c.length)==c};this.__StringEndsWith=function(a,c){return a.slice(-c.length)==c};this.__GetCookie=function(a){a+="=";for(var c=document.cookie.split(";"),d=0;d<c.length;d++){for(var b=c[d];" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(a))return b.substring(a.length,b.length)}return null};this.__xhr=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.createRequest)return window.createRequest();
if(window.ActiveXObject)for(var a=["Msxml3.XMLHTTP","Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<a.length;c++)try{return new ActiveXObject(a[c])}catch(d){}};this.__translateWindowsError=function(a){switch(a){case 12001:return"Internet handle could not be generated at this time.";case 12002:return"Request timed out.";case 12004:return"An internal internet error has occured.";case 12005:return"URL is invalid.";case 12006:return"URL scheme could not be recognized or is not supported.";
case 12007:return"Server name could not be resolved.";case 12008:return"The requested protocol could not be found.";case 12013:return"Failed to log on to FTP server, user name is incorrect.";case 12014:return"Failed to log on to FTP server, password is incorrect.";case 12015:return"Failed to coonect and log on to FTP server.";case 12023:return"Direct network access cannot be made at this time.";case 12029:return"Unable to connect to server.";case 12030:return"Connection terminated.";case 12031:return"Connection reset.";
case 12037:return"Date on server's SSL certificate is bad expired.";case 12038:return"Host name on server's SSL certificate is incorrect.";case 12040:return"Moving from non-SSL to SSL due to redirect.";case 12042:return"Attempt to post and change data on server that is not secure.";case 12043:return"Attempt to post data on server that is not secure.";case 12110:return"FTP operation failed, operation is already in progress.";case 12111:return"FTP operation failed, the session was aborted.";case 12150:return"Requested HTTP header could not be found.";
case 12151:return"Server returned no HTTP headers.";case 12152:return"Server response could not be parsed.";case 12156:return"HTTP redirect failed, scheme changed or all attempts failed."}};this.__ajax=function(a,c,d,b,f,g){var e=new Organics.__xhr;if(e){var j=null;f&&(j=setTimeout(function(){e.abort();d.error(e,"timed out")},f));e.onreadystatechange=function(){if(4==e.readyState)if(j&&clearTimer(j),200==e.status)d.complete(e);else{var a=Organics.__translateWindowsError(e.status);Organics.__isPageBeingRefreshed&&
0==e.status||(0==e.status?d.error(e,"network error"):null!=a?d.error(e,e.status+" "+a):d.error(e,e.status+" "+e.statusText))}};try{e.open(c,a,!0)}catch(l){d.error(e,"XMLHttpRequest.open failed: "+l);return}null==g&&(g={});null==g["Content-Type"]&&(g["Content-Type"]="text/plain;charset=UTF-8");if(g)for(var q in g)e.setRequestHeader(q,g[q]);try{e.send(b)}catch(r){d.error(e,"XMLHttpRequest.send failed: "+r)}}else d.error(null,"Browser has no support for AJAX")};this.Connection=function(a,c,d){var b=
this;b.__requestCounter=-1;b.__requestHandlers={};b.__URL=a;if("string"!=typeof b.__URL)throw TypeError("URL parameter must be an string!");b.URL=b.__URL;b.TLS=c;null==b.TLS&&(b.TLS=!1);if("boolean"!=typeof b.TLS)throw TypeError("TLS optional parameter must be bool!");b.Timeout=d;null==b.Timeout&&(b.Timeout=15E3);b.Timeout=d;b.__handlers={};b.__connected=!1;b.__connecting=!1;Organics.__StringStartsWith(b.__URL,"/")&&(b.__URL=document.location.host+b.__URL);Organics.__StringStartsWith(b.__URL,"ws://")?
b.__URL=b.__URL.slice(5):Organics.__StringStartsWith(b.__URL,"wss://")?b.__URL=b.__URL.slice(6):Organics.__StringStartsWith(b.__URL,"http://")?b.__URL=b.__URL.slice(7):Organics.__StringStartsWith(b.__URL,"https://")&&(b.__URL=b.__URL.slice(8));b.__HTTP_URL=b.TLS?"https://"+b.__URL:"http://"+b.__URL;b.__URL=Organics.WebSocketSupported?b.TLS?"wss://"+b.__URL:"ws://"+b.__URL:b.TLS?"https://"+b.__URL:"http://"+b.__URL;b.__logMessage=function(a){Organics.__Log("("+b.__URL+"): "+a)};b.__handleDisconnect=
function(a){if(!0==b.__connected||!0==b.__connecting){b.__connected=!1;b.__connecting=!1;b.__logMessage('-> Disconnected: "'+a+'"');var c=b.__handlers[Organics.Disconnect];c&&c(a)}b.__connected=!1;b.__connecting=!1};b.__handleConnect=function(){b.__logMessage("-> Connected");var a=b.__handlers[Organics.Connect];a&&a()}};this.Connection.prototype.Connected=function(){return!0==this.__connecting?!1:this.__connected};this.Connection.prototype.Close=function(){!0==this.__connected&&(this.__connected=
!1,Organics.WebSocketSupported&&this.__webSocket.close())};this.Connection.prototype.Connect=function(){var a=this;Organics.WebSocketSupported?a.__logMessage("WebSocket is supported"):a.__logMessage("No WebSocket support; using long polling");!a.__connected&&!a.__connecting&&(a.__logMessage("-> Connect()"),a.__connecting=!0,Organics.__ajax(a.__HTTP_URL,"POST",{complete:function(c){Organics.WebSocketSupported?(a.__logMessage("-> Create session request successful"),a.__connectWebSocket()):(a.__connectionId=
c.responseText,a.__logMessage("-> Create session request successful: connected to server"),a.__connected=!0,a.__connecting=!1,setTimeout(function(){a.__doLongPolling()},0),a.__handleConnect())},error:function(c,d){a.__handleDisconnect("Create session request failed ("+d+")")}},null,a.Timeout,{"X-Organics-Req":Organics.WebSocketSupported?Organics.__rtWebSocketEstablishConnection:Organics.__rtLongPollEstablishConnection}))};this.Connection.prototype.__handleMessage=function(a){if(0<a.length){try{var c=
JSON.parse(a)}catch(d){this.__handleDisconnect("Server sent bad JSON data: "+d);Organics.webSocketSupported&&this.__webSocket.close();return}if(3==c.length){a=c[0];var b=c[1],c=c[2],f=null,g=this.__handlers[b];if(g){try{f=g.apply(void 0,c),null==f&&(f=[])}catch(e){Organics.__Log("Request handler exception:\n"+e);return}if(-1!==a)try{return JSON.stringify([a,f])}catch(j){Organics.__Log("Error encoding response:\n"+j)}}else Organics.__Log('Ignoring request "'+b+'", no handler.')}else if(2==c.length||
1==c.length)if(a=c[0],c=1==c.length?[]:c[1],a=this.__requestHandlers[a])try{a.apply(void 0,c)}catch(l){Organics.__Log("Request handler onComplete exception:\n"+l)}else Organics.__Log("Got invalid response; id is invalid; ignored.");else this.__handleDisconnect("Server sent bad JSON data: Must be array of length 3"),Organics.webSocketSupported&&this.__webSocket.close()}else if(Organics.WebSocketSupported)return""};this.Connection.prototype.__connectWebSocket=function(){var a=this;window.WebSocket?
a.__webSocket=new WebSocket(a.__URL):window.MozWebSocket&&(a.__webSocket=new MozWebSocket(a.__URL));a.__webSocket.onopen=function(){a.__connected=!0;a.__connecting=!1;a.__handleConnect()};a.__webSocket.onclose=function(){a.__handleDisconnect("connection closed")};a.__webSocket.onmessage=function(c){c=a.__handleMessage(c.data);null!=c&&a.__webSocket.send(c)};a.__webSocket.onerror=function(c){a.__handleDisconnect("disconnected"+c)}};this.Connection.prototype.__doLongPolling=function(){var a=this;Organics.__ajax(a.__HTTP_URL,
"POST",{complete:function(c){c=a.__handleMessage(c.responseText);null!=c&&Organics.__ajax(a.__HTTP_URL,"POST",{complete:function(){},error:function(c,b){a.__handleDisconnect("POST request failed ("+b+")",0)}},c,null,{"X-Organics-Req":Organics.__rtMessage,"X-Organics-Conn":a.__connectionId});setTimeout(function(){a.__doLongPolling()},0)},error:function(c,d){a.__handleDisconnect("long-polling request failed ("+d+")",0)}},null,null,{"X-Organics-Req":Organics.__rtLongPoll,"X-Organics-Conn":a.__connectionId})};
this.Connection.prototype.Request=function(){var a=this,c=Array.prototype.slice.call(arguments);if(0!=c.length){var d=c[0];if(1<c.length){var b=c[c.length-1];"function"!=typeof b&&(b=null)}else b=null;c=null!=b?c.slice(1,c.length-1):c.slice(1,c.length);if(!a.Connected())throw a.__logMessage("-> Ignoring Request() call (Not connected)"),Organics.ErrNotConnected;a.__requestCounter++;-1==a.__requestCounter&&a.__requestCounter++;var f=a.__requestCounter;b?a.__requestHandlers[a.__requestCounter]=b:f=-1;
d=JSON.stringify([f,d,c]);Organics.WebSocketSupported?a.__webSocket.send(d):Organics.__ajax(a.__HTTP_URL,"POST",{complete:function(){},error:function(b,c){b&&413==b.status?a.__handleDisconnect("JSON request data exceeded server's MaxBufferSize property.",0):a.__handleDisconnect("Request failed: "+c)}},d,a.Timeout,{"X-Organics-Req":Organics.__rtMessage,"X-Organics-Conn":a.__connectionId})}};this.Connection.prototype.Handle=function(a,c){if(null===c)delete this.__handlers[a];else{if("function"!==typeof c)throw TypeError('Handle() parameter "handler" must be function!');
this.__handlers[a]=c}}};
